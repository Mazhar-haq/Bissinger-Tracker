<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bissinger's Herald Square Truffle Tracker</title>
    <style>
        :root {
            --bissingers-brown: #3d2b1f; 
            --bissingers-gold: #c5a059;  
            --bissingers-cream: #f9f6f2;
            --primary: var(--bissingers-brown);
            --secondary: #5d4037;
            --accent: var(--bissingers-gold);
            --success: #4a6741;
            --danger: #9e2a2b;
            --info: #2c3e50;
            --light: #f4eee8;
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
            padding: 10px;
            background: var(--light);
            color: var(--bissingers-brown);
            line-height: 1.5;
            padding-bottom: 100px; /* Space for summary footer */
        }

        .header {
            background: var(--bissingers-brown);
            color: var(--bissingers-gold);
            padding: 20px 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-bottom: 3px solid var(--bissingers-gold);
        }

        .header h1 { font-size: 1.4rem; letter-spacing: 1px; text-transform: uppercase; font-weight: 300; }

        /* STICKY TABS */
        .floor-tabs { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 15px; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            background: var(--light); 
            padding: 10px 0;
        }

        .tab-btn {
            flex: 1; padding: 12px; background: #e0dcd8; border: none; border-radius: 4px;
            font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
            color: #666; transition: all 0.3s; font-size: 0.8rem;
        }

        .tab-btn.active { background: var(--bissingers-brown); color: var(--bissingers-gold); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }

        .floor-view { display: none; }
        .floor-view.active { display: block; }

        .card {
            background: var(--white); padding: 15px; border-radius: 4px; margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(61, 43, 31, 0.1); border: 1px solid rgba(197, 160, 89, 0.2);
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        @media (min-width: 600px) {
            .input-grid { grid-template-columns: repeat(3, 1fr); }
            body { padding: 20px; }
        }

        .input-group { display: flex; flex-direction: column; gap: 4px; }
        .input-group label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        input, select { padding: 10px; border: 1px solid #dcdcdc; border-radius: 2px; width: 100%; font-size: 0.95rem; }

        .table-container { overflow-x: auto; margin: 0 -5px; }
        table { width: 100%; border-collapse: collapse; min-width: 450px; }
        thead { background: var(--bissingers-brown); color: var(--bissingers-gold); }
        th { padding: 8px 4px; text-align: center; font-size: 0.6rem; text-transform: uppercase; }
        th:first-child { text-align: left; padding-left: 10px; }
        td { padding: 8px 4px; border-bottom: 1px solid #f0f0f0; text-align: center; }
        td:first-child { text-align: left; padding-left: 10px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; }

        .count-input {
            width: 50px;
            text-align: center;
            padding: 6px 2px;
            font-size: 0.9rem;
            border: 1px solid #eee;
        }

        .calculated { font-weight: bold; font-size: 0.9rem; color: var(--bissingers-brown); }
        .sold-text { color: var(--success); font-weight: bold; }
        .low-stock { color: var(--danger) !important; animation: pulse 2s infinite; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* SUMMARY FOOTER */
        .summary-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bissingers-brown);
            color: var(--bissingers-gold);
            padding: 15px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .summary-item { text-align: center; }
        .summary-label { font-size: 0.65rem; text-transform: uppercase; display: block; }
        .summary-val { font-size: 1.2rem; font-weight: bold; }

        .btn-export {
            background: var(--success);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 5px;
        }

        .btn-copy {
            background: var(--info);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.7rem; font-weight: bold; text-transform: uppercase; cursor: pointer; margin-top: 5px;
        }

        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: var(--bissingers-brown); color: var(--bissingers-gold); padding: 12px 24px; border-radius: 4px; opacity: 0; transition: opacity 0.3s; z-index: 1001; pointer-events: none; white-space: nowrap; }

        @media (max-width: 400px) {
            th { font-size: 0.55rem; }
            .count-input { width: 45px; font-size: 0.85rem; }
        }
    </style>
</head>
<body onload="init()">

    <div id="toast" class="toast">Action Complete</div>

    <div class="header">
        <h1>Bissinger's Herald Square Truffle Tracker</h1>
        <p id="displayDate">Loading...</p>
    </div>

    <!-- Management Info -->
    <div class="card">
        <div class="input-grid">
            <div class="input-group">
                <label>Inventory Date</label>
                <input type="date" id="trackingDate" onchange="updateDateDisplay(); saveData();">
            </div>
            <div class="input-group">
                <label>Opening MOD</label>
                <select id="openingMod" onchange="saveData()">
                    <option value="">Select...</option>
                    <option>Tom</option><option>Arin</option><option>Czar</option><option>Faith</option><option>Gully</option>
                    <option>Associate</option>
                </select>
            </div>
            <div class="input-group">
                <label>Closing MOD</label>
                <select id="closingMod" onchange="saveData()">
                    <option value="">Select...</option>
                    <option>Tom</option><option>Arin</option><option>Czar</option><option>Faith</option><option>Gully</option>
                    <option>Associate</option>
                </select>
            </div>
        </div>
        <div style="display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap;">
            <button class="tab-btn" style="background:#eee; color:#333; flex:1; min-width: 70px;" onclick="clearAll()">Reset</button>
            <button class="tab-btn active" style="flex:2; min-width: 140px;" onclick="lockAM()">Lock AM</button>
            <button class="btn-copy" style="flex: 1.5; min-width: 130px;" onclick="copyAMTextReport()">ðŸ“‹ Am text report</button>
            <button class="btn-export" style="flex: 1; min-width: 110px;" onclick="exportCSV()">Export CSV</button>
        </div>
    </div>

    <div class="floor-tabs">
        <button class="tab-btn active" id="btn-f6" onclick="switchFloor('f6')">6th Floor</button>
        <button class="tab-btn" id="btn-f1" onclick="switchFloor('f1')">1st Floor</button>
    </div>

    <!-- 6th Floor -->
    <div id="f6-view" class="floor-view active">
        <div class="card" style="padding: 10px;">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 35%;">Flavor</th>
                            <th>AM</th>
                            <th>PM</th>
                            <th>Refill</th>
                            <th>Sold</th>
                            <th>End</th>
                        </tr>
                    </thead>
                    <tbody id="f6Body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 1st Floor -->
    <div id="f1-view" class="floor-view">
        <div class="card" style="padding: 10px;">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 35%;">Flavor</th>
                            <th>AM</th>
                            <th>PM</th>
                            <th>Refill</th>
                            <th>Sold</th>
                            <th>End</th>
                        </tr>
                    </thead>
                    <tbody id="f1Body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Summary Footer -->
    <div class="summary-footer">
        <div class="summary-item">
            <span class="summary-label">6th Floor Count</span>
            <span class="summary-val" id="total-f6">0</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Total Count</span>
            <span class="summary-val" id="total-grand" style="color: white; border-bottom: 2px solid var(--bissingers-gold);">0</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">1st Floor Count</span>
            <span class="summary-val" id="total-f1">0</span>
        </div>
    </div>

    <script>
        const f6List = [
            "BIRTHDAY CAKE TRUFFLE", 
            "WEDDING CAKE TRUFFLE", 
            "MILK CHOCOLATE CARAMEL CHEESECAKE TRUFFLE", 
            "ROOT BEER FLOAT TRUFFLE", 
            "STRAWBERRY TRUFFLE", 
            "STRAWBERRY CHEESECAKE TRUFFLE", 
            "CRÃˆME BRÃ›LÃ‰E TRUFFLE", 
            "TIRAMISU TRUFFLE", 
            "PINEAPPLE UPSIDE DOWN TRUFFLE", 
            "RED VELVET CAKE TRUFFLE", 
            "IRISH CREAM TRUFFLE", 
            "DARK CHOCOLATE CANDY CANE TRUFFLE", 
            "CHOCOLATE SOUFFLÃ‰ TRUFFLE", 
            "WHITE EURO TRUFFLE", 
            "WHITE RUSSIAN TRUFFLE", 
            "CHOCOLATE MILKSHAKE TRUFFLE", 
            "MILK CHOCOLATE CARAMEL FUDGE BROWNIE TRUFFLE", 
            "DARK CHOCOLATE CARAMEL MACCHIATO TRUFFLE", 
            "GERMAN CHOCOLATE TRUFFLE", 
            "MILK SWISS CHOCOLATE TRUFFLE", 
            "DARK SWISS CHOCOLATE TRUFFLE", 
            "DARK SEA SALT CARAMEL TRUFFLE", 
            "MILK CHOCOLATE RASPBERRY CREAM", 
            "MILK CHOCOLATE ORANGE CREAM", 
            "DARK CHOCOLATE MAPLE PECAN CREAM", 
            "PISTACHIO CROWN TRUFFLE", 
            "ITALIAN ESPRESSO TRUFFLE", 
            "DARK CHOCOLATE CARAMEL", 
            "FRESH MINT TRUFFLE", 
            "DARK CREAM MINT", 
            "MILK SEA SALT CARAMEL", 
            "DARK CINNAMON ALMOND CARAMEL", 
            "MILK CHOCOLATE SWISS PECAN CREAM", 
            "MILK VANILLA DREAM", 
            "FRENCH VANILLA \"B\"", 
            "MILK CHOCOLATE ENGLISH ALMOND TOFFEE", 
            "DARK CHOCOLATE ENGLISH ALMOND TOFFEE", 
            "LEMON TEARDROP TRUFFLE", 
            "RASPBERRY CARAMEL JEWEL"
        ];
        
        const f1List = [
            "BIRTHDAY CAKE TRUFFLE", 
            "WEDDING CAKE TRUFFLE", 
            "WHITE EURO TRUFFLE", 
            "DARK CHOCOLATE SEA SALT CARAMEL TRUFFLE", 
            "MILK CHOCOLATE TIRAMISU TRUFFLE",
            "DARK CHOCOLATE FRENCH VANILLA \"B\"", 
            "DARK CHOCOLATE RASPBERRY CARAMEL JEWEL", 
            "PISTACHIO CROWN TRUFFLE", 
            "MILK CHOCOLATE CARAMEL FUDGE BROWNIE TRUFFLE", 
            "MILK CHOCOLATE FRENCH SEA SALT CARAMEL", 
            "MILK CHOCOLATE SWISS PECAN CREAM"
        ];

        let currentFloor = 'f6';

        function init() {
            const d = document.getElementById('trackingDate');
            if (!d.value) d.valueAsDate = new Date();
            updateDateDisplay();
            renderRows(f6List, 'f6Body', 'f6');
            renderRows(f1List, 'f1Body', 'f1');
            loadData();
        }

        function renderRows(list, containerId, prefix) {
            const container = document.getElementById(containerId);
            list.forEach((name, i) => {
                const id = `${prefix}_${i}`;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${name}</td>
                    <td><input type="number" id="${id}_am" class="count-input" oninput="calc('${id}')" placeholder="0"></td>
                    <td><input type="number" id="${id}_pm" class="count-input" oninput="calc('${id}')" placeholder="0"></td>
                    <td><input type="number" id="${id}_refill" class="count-input" oninput="calc('${id}')" placeholder="0"></td>
                    <td class="sold-text" id="${id}_sold">0</td>
                    <td class="calculated" id="${id}_end">0</td>
                `;
                container.appendChild(row);
            });
        }

        function calc(id) {
            const amVal = document.getElementById(`${id}_am`).value;
            const pmVal = document.getElementById(`${id}_pm`).value;
            const refillVal = document.getElementById(`${id}_refill`).value;

            const am = parseInt(amVal) || 0;
            const pm = parseInt(pmVal) || 0;
            const refill = parseInt(refillVal) || 0;
            
            const end = pm + refill;
            const endEl = document.getElementById(`${id}_end`);
            endEl.textContent = end;

            if (end > 0 && end < 5) {
                endEl.classList.add('low-stock');
            } else {
                endEl.classList.remove('low-stock');
            }

            const soldEl = document.getElementById(`${id}_sold`);
            if (pmVal !== "") {
                const sold = Math.max(0, (am + refill) - pm);
                soldEl.textContent = sold;
            } else {
                soldEl.textContent = "0";
            }

            updateTotals();
            saveData();
        }

        function updateTotals() {
            const sumEnd = (prefix, list) => list.reduce((acc, _, i) => {
                const el = document.getElementById(`${prefix}_${i}_end`);
                const val = el ? (parseInt(el.textContent) || 0) : 0;
                return acc + val;
            }, 0);

            const f6Total = sumEnd('f6', f6List);
            const f1Total = sumEnd('f1', f1List);

            document.getElementById('total-f6').textContent = f6Total;
            document.getElementById('total-f1').textContent = f1Total;
            document.getElementById('total-grand').textContent = f6Total + f1Total;
        }

        function switchFloor(f) {
            currentFloor = f;
            document.querySelectorAll('.floor-view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`${f}-view`).classList.add('active');
            document.getElementById(`btn-${f}`).classList.add('active');
        }

        function updateDateDisplay() {
            const dInput = document.getElementById('trackingDate').value;
            if(!dInput) return;
            const d = new Date(dInput + 'T00:00:00');
            document.getElementById('displayDate').textContent = d.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function saveData() {
            const pack = (p, list) => list.map((_, i) => ({
                am: document.getElementById(`${p}_${i}_am`).value,
                pm: document.getElementById(`${p}_${i}_pm`).value,
                ref: document.getElementById(`${p}_${i}_refill`).value,
                l: document.getElementById(`${p}_${i}_am`).disabled
            }));
            const data = { 
                d: document.getElementById('trackingDate').value,
                oMod: document.getElementById('openingMod').value,
                cMod: document.getElementById('closingMod').value,
                f6: pack('f6', f6List),
                f1: pack('f1', f1List)
            };
            localStorage.setItem('biss_data_v13', JSON.stringify(data));
        }

        function loadData() {
            const raw = localStorage.getItem('biss_data_v13');
            if (!raw) return;
            const data = JSON.parse(raw);
            document.getElementById('trackingDate').value = data.d;
            document.getElementById('openingMod').value = data.oMod || '';
            document.getElementById('closingMod').value = data.cMod || '';
            updateDateDisplay();
            
            data.f6.forEach((item, i) => {
                const id = `f6_${i}`;
                if (!document.getElementById(`${id}_am`)) return;
                document.getElementById(`${id}_am`).value = item.am;
                document.getElementById(`${id}_pm`).value = item.pm;
                document.getElementById(`${id}_refill`).value = item.ref;
                if (item.l) document.getElementById(`${id}_am`).disabled = true;
                calc(id);
            });

            data.f1.forEach((item, i) => {
                const id = `f1_${i}`;
                if (!document.getElementById(`${id}_am`)) return;
                document.getElementById(`${id}_am`).value = item.am;
                document.getElementById(`${id}_pm`).value = item.pm;
                document.getElementById(`${id}_refill`).value = item.ref;
                if (item.l) document.getElementById(`${id}_am`).disabled = true;
                calc(id);
            });
            
            updateTotals();
        }

        function lockAM() {
            document.querySelectorAll('input[id$="_am"]').forEach(el => el.disabled = true);
            saveData();
            showToast("Morning counts locked");
        }

        function clearAll() { if(confirm("Clear everything?")) { localStorage.clear(); location.reload(); } }

        function showToast(m) {
            const t = document.getElementById('toast');
            t.textContent = m; t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 2500);
        }

        function copyAMTextReport() {
            const date = document.getElementById('displayDate').textContent;
            const oMod = document.getElementById('openingMod').value || "N/A";
            
            let report = `BISSINGER'S AM TRUFFLE REPORT\nDate: ${date}\nOpening MOD: ${oMod}\n\n`;
            
            const addSection = (title, list, prefix) => {
                report += `--- ${title.toUpperCase()} FLOOR AM COUNTS ---\n`;
                list.forEach((name, i) => {
                    const id = `${prefix}_${i}`;
                    const am = document.getElementById(`${id}_am`).value || 0;
                    if (parseInt(am) > 0) {
                        report += `${name}: ${am}\n`;
                    }
                });
                report += `\n`;
            };

            addSection("6th", f6List, "f6");
            addSection("1st", f1List, "f1");
            
            const dummy = document.createElement("textarea");
            document.body.appendChild(dummy);
            dummy.value = report;
            dummy.select();
            document.execCommand("copy");
            document.body.removeChild(dummy);
            
            showToast("AM report copied to clipboard!");
        }

        function exportCSV() {
            const date = document.getElementById('trackingDate').value;
            let csv = `Bissinger's Truffle Report - ${date}\n`;
            csv += `Opening MOD: ${document.getElementById('openingMod').value}, Closing MOD: ${document.getElementById('closingMod').value}\n\n`;
            
            const process = (floorName, list, prefix) => {
                csv += `${floorName} FLOOR\n`;
                csv += `Flavor,AM,PM,Refill,Sold,End\n`;
                list.forEach((name, i) => {
                    const id = `${prefix}_${i}`;
                    const am = document.getElementById(`${id}_am`).value || 0;
                    const pm = document.getElementById(`${id}_pm`).value || 0;
                    const refill = document.getElementById(`${id}_refill`).value || 0;
                    const sold = document.getElementById(`${id}_sold`).textContent;
                    const end = document.getElementById(`${id}_end`).textContent;
                    csv += `"${name}",${am},${pm},${refill},${sold},${end}\n`;
                });
                csv += `\n`;
            };

            process('6th', f6List, 'f6');
            process('1st', f1List, 'f1');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Truffle_Report_${date}.csv`;
            a.click();
            showToast("CSV Exported");
        }
    </script>
</body>
</html>
